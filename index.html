<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PMW25 REGISTERED MEMBER BADGE GENERATOR</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f5f5f5;
        padding: 20px;
    }
    #crop-container {
        max-width: 300px;
        margin: auto;
    }
    #cropBtn {
        margin-top: 10px;
    }
    canvas {
        border: 1px solid #ccc;
        background: white;
        max-width: 100%;
        margin-top: 20px;
    }
    button, input[type=file] {
        margin: 10px;
        padding: 10px 20px;
        background: #0077b6;
        color: white;
        border: none;
        cursor: pointer;
    }
    button:hover {
        background: #005f86;
    }
</style>
</head>
<body>

<h2>PMW25 REGISTERED MEMBER BADGE GENERATOR</h2>
<input type="file" id="upload" accept="image/*"><br>

<div id="crop-container">
    <img id="crop-image" style="max-width:100%; display:none;">
    <button id="cropBtn" style="display:none;">Crop & Generate Badge</button>
</div>

<canvas id="badgeCanvas" width="800" height="800"></canvas><br>
<button id="downloadBtn" style="display:none;">Download Badge</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script>
let cropper;
const canvas = document.getElementById('badgeCanvas');
const ctx = canvas.getContext('2d');

// Load badge overlay
const badge = new Image();
badge.src = 'badge-2.png'; // Path to your badge image
badge.onload = () => {
    ctx.drawImage(badge, 0, 0, canvas.width, canvas.height);
};

// Handle image upload
document.getElementById('upload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
        const imgElement = document.getElementById('crop-image');
        imgElement.src = event.target.result;
        imgElement.style.display = 'block';

        if (cropper) cropper.destroy();
        cropper = new Cropper(imgElement, {
            aspectRatio: 1,       // Keep square crop
            viewMode: 1,
            movable: true,
            zoomable: true,
            scalable: true,
            responsive: true,
            autoCropArea: 0.8,   // Default crop box fills 80%
        });

        document.getElementById('cropBtn').style.display = 'inline-block';
    };
    reader.readAsDataURL(file);
});

// Handle crop & badge generation
document.getElementById('cropBtn').addEventListener('click', function() {
    if (!cropper) return;

    // Get cropped image at original crop size (any)
    const croppedCanvas = cropper.getCroppedCanvas();

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Circular mask for profile area
    ctx.save();
    ctx.beginPath();
    ctx.arc(400, 310, 105, 0, Math.PI * 2, true);
    ctx.closePath();
    ctx.clip();

    // Scale cropped image to fit 210x210 inside badge circle
    ctx.drawImage(croppedCanvas, 295, 205, 210, 210);
    ctx.restore();

    // Draw badge overlay
    ctx.drawImage(badge, 0, 0, canvas.width, canvas.height);

    document.getElementById('downloadBtn').style.display = 'inline-block';
});

// Handle download
document.getElementById('downloadBtn').addEventListener('click', function() {
    const finalImage = canvas.toDataURL("image/png");
    const link = document.createElement('a');
    link.href = finalImage;
    link.download = 'PMW25-badge.png';
    link.click();
});
</script>

</body>
</html>
